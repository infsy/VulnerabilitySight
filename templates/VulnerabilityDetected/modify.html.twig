{# ressources/VulnerabilityDetected/modify.html.twig #}

{% extends "base.html.twig" %}

{% block title %}
    Edit vulnerability
{% endblock %}

{% block vuln_body %}

{# Array of persons #}
{% set persons = personsList %}

<style type="text/css">
   .title2 {
       color: #696363;
       font-family: sans-serif;
       font-size: 26px;
       font-weight: bold;
       display: block;
       border-bottom: 1px solid;
       border-bottom-color: #837c7c;
       margin-left: 1.5em;
       margin-top: 1.2em;
   }
   .title3 {
       margin-left: 1.8em;
       color: #514d4d;
   }
   .sp1 {
       display:inline-block;
       width:50%;
       padding-top:1px;
       margin-left: 2.5em;
       color: #514d4d;
   }
   .txtar1 {
       resize: none;
       height: 7em;
       width: 75%;
   }

</style>

<h1 class="title2">
    {{ vulnerabilityDetected.vulnerability.description }}
</h1>
<div>
    <h3 class="title3">Asset</h3>
    <span class="sp1">
        {{ vulnerabilityDetected.asset.ip }}
    </span>
</div>
<div>
    <h3 class="title3">Details</h3>
    <span class="sp1">
        {{ vulnerabilityDetected.vulnerability.details }}
    </span>
</div>
<div>
  <h3 class="title3"> Edit </h3>
  <span class="sp1">
      <form action="{{ path('app_vulnerabilitydetected_edit', {'view': previousView, 'id': vulnerabilityDetected.id}) }}" method="post">
          Status:
          <select id="status" name="status" onchange="EnableForm()">
              <option value="1">Open</option>
              <option value="2">Close</option>
              <option value="3">Re-Open</option>
              <option value="4">Affected</option>
          </select>
          <script>
              var s = document.getElementById("status");
              s.options[{{ vulnerabilityDetected.status.id }} - 1].selected = true;
          </script>
          &nbsp;&nbsp;In charge:
          <select id="person" name="person" style="background: #D3D3D3;" disabled>
              <option value="0" selected></option>
              <option value="1">John Septgrain</option>
              <option value="2">Dan Grenier</option>
              <script>
                  //var start = 2016;
                  //var end = new Date().getFullYear();
                  /*var options = "";
                  var y = document.getElementById("person");
                 for(x in persons)
                 {
                    options += "<option selected>" + x + "</option>";
                    //x.p_id
                    //options += "<option>" + x + "</option>";
                }*/
                 //y.innerHTML = options;
              </script>
          </select>
          &nbsp;&nbsp;Remediation action:
          <select id="remediation" name="remediation" style="background: #D3D3D3;" disabled>
              <option value="0" selected></option>
              <option value="1">Action 1</option>
              <option value="2">Action 2</option>
          </select>
          <a href="{{ path('addRemediation', {'view': 5, 'id': 48499}) }}" title="Add remediation action" data-hover="tooltip"><span class="glyphicon glyphicon-plus" style="color: green;"></span></a>
          <br><br> Comment: <br>
          <textarea id="comment" name="comment" class="txtar1">{{ vulnerabilityDetected.comment }}</textarea>
          <br><br><input type="submit" value="Update" style="width: 7em; float: left;"/>
      </form>
      <form action="{{ path('app_vulnerabilitydetected_edit', {'view': previousView, 'id': vulnerabilityDetected.id}) }}" method="post">
          <input type="hidden" id="cancel" name="cancel" value="1"/>
          <input type="submit" value="Cancel" style="width: 7em;"/>
      </form>
      <br> *Last modification was on {{ vulnerabilityDetected.date_modified |date("Y/m/d") }} <br>
  </span>
</div>
<script>
function EnableForm() {
    var s = document.getElementById("status");
    var chc = s.options[s.selectedIndex].text;
    if(chc == "Re-Open" || chc == "Affected")
    {
        document.getElementById("person").disabled = false;
        document.getElementById("remediation").disabled = false;
        document.getElementById("person").style.background = "white";
        document.getElementById("remediation").style.background = "white";
    }
}
</script>

{% endblock %}
