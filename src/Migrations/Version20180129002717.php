<?php declare(strict_types = 1);

namespace DoctrineMigrations;

use Doctrine\DBAL\Migrations\AbstractMigration;
use Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your needs!
 */
class Version20180129002717 extends AbstractMigration
{
    public function up(Schema $schema)
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() !== 'mysql', 'Migration can only be executed safely on \'mysql\'.');

        $this->addSql('CREATE TABLE action (id INT AUTO_INCREMENT NOT NULL, remediation_action_id INT DEFAULT NULL, name VARCHAR(140) NOT NULL, steps LONGTEXT DEFAULT NULL, INDEX IDX_47CC8C92D8E2CBE7 (remediation_action_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE asset (id INT AUTO_INCREMENT NOT NULL, type_id INT DEFAULT NULL, vlan_id INT DEFAULT NULL, owner_id INT DEFAULT NULL, admin_id INT DEFAULT NULL, ip VARCHAR(32) DEFAULT NULL, fqdn VARCHAR(240) DEFAULT NULL, name VARCHAR(60) DEFAULT NULL, description VARCHAR(240) DEFAULT NULL, INDEX IDX_2AF5A5CC54C8C93 (type_id), INDEX IDX_2AF5A5C8B4937A1 (vlan_id), INDEX IDX_2AF5A5C7E3C61F9 (owner_id), INDEX IDX_2AF5A5C642B8210 (admin_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE assets_tags (asset_id INT NOT NULL, tag_id INT NOT NULL, INDEX IDX_D7AC0F375DA1941 (asset_id), INDEX IDX_D7AC0F37BAD26311 (tag_id), PRIMARY KEY(asset_id, tag_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE branch (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(30) NOT NULL, description VARCHAR(60) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE detection (id INT AUTO_INCREMENT NOT NULL, date_execution DATE DEFAULT NULL, date_upload DATE DEFAULT NULL, source_name VARCHAR(80) NOT NULL, source_reference VARCHAR(80) NOT NULL, method VARCHAR(120) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE family (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(30) NOT NULL, description VARCHAR(60) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE office (id INT AUTO_INCREMENT NOT NULL, branch_id INT DEFAULT NULL, name VARCHAR(30) NOT NULL, INDEX IDX_74516B02DCD6CC49 (branch_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE person (id INT AUTO_INCREMENT NOT NULL, office_id INT DEFAULT NULL, first_name VARCHAR(80) NOT NULL, last_name VARCHAR(80) NOT NULL, email VARCHAR(80) NOT NULL, extension VARCHAR(10) DEFAULT NULL, phone VARCHAR(11) DEFAULT NULL, INDEX IDX_34DCD176FFA0C224 (office_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE product (id INT AUTO_INCREMENT NOT NULL, vendor_id INT DEFAULT NULL, cpe_wfn VARCHAR(240) DEFAULT NULL, cpe_string VARCHAR(240) DEFAULT NULL, cpe_uri VARCHAR(200) DEFAULT NULL, version VARCHAR(4) NOT NULL, `release` VARCHAR(50) DEFAULT NULL, name VARCHAR(80) NOT NULL, edition VARCHAR(20) DEFAULT NULL, target_hw VARCHAR(10) DEFAULT NULL, `update` VARCHAR(20) DEFAULT NULL, language VARCHAR(20) DEFAULT NULL, INDEX IDX_D34A04ADF603EE73 (vendor_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE products_tags (product_id INT NOT NULL, tag_id INT NOT NULL, INDEX IDX_E3AB5A2C4584665A (product_id), INDEX IDX_E3AB5A2CBAD26311 (tag_id), PRIMARY KEY(product_id, tag_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE remediation_action (id INT AUTO_INCREMENT NOT NULL, person_id INT DEFAULT NULL, date_created DATE NOT NULL, date_planned DATE DEFAULT NULL, date_applied DATE DEFAULT NULL, comment VARCHAR(240) DEFAULT NULL, INDEX IDX_C49F0909217BBB47 (person_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE status (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(40) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE tag (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(140) NOT NULL, date_created DATE NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE tag_product (tag_id INT NOT NULL, product_id INT NOT NULL, INDEX IDX_E17B2907BAD26311 (tag_id), INDEX IDX_E17B29074584665A (product_id), PRIMARY KEY(tag_id, product_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE tag_asset (tag_id INT NOT NULL, asset_id INT NOT NULL, INDEX IDX_2043435ABAD26311 (tag_id), INDEX IDX_2043435A5DA1941 (asset_id), PRIMARY KEY(tag_id, asset_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE tag_vulnerability_detected (tag_id INT NOT NULL, vulnerability_detected_id INT NOT NULL, INDEX IDX_2ED00885BAD26311 (tag_id), INDEX IDX_2ED0088529518A4D (vulnerability_detected_id), PRIMARY KEY(tag_id, vulnerability_detected_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE type (id INT AUTO_INCREMENT NOT NULL, family_id INT DEFAULT NULL, name VARCHAR(30) NOT NULL, description VARCHAR(60) DEFAULT NULL, INDEX IDX_8CDE5729C35E566A (family_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE vendor (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(80) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE vlan (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(30) NOT NULL, description VARCHAR(60) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE vulnerability (id INT AUTO_INCREMENT NOT NULL, product_id INT DEFAULT NULL, cve VARCHAR(20) DEFAULT NULL, cvss NUMERIC(10, 1) DEFAULT NULL, description VARCHAR(240) NOT NULL, details LONGTEXT DEFAULT NULL, plugin_id INT DEFAULT NULL, severity INT DEFAULT NULL, solution LONGTEXT DEFAULT NULL, references_vulnerability LONGTEXT DEFAULT NULL, output LONGTEXT DEFAULT NULL, INDEX IDX_6C4E40474584665A (product_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE vulnerability_detected (id INT AUTO_INCREMENT NOT NULL, vulnerability_id INT NOT NULL, remediation_action_id INT DEFAULT NULL, asset_id INT NOT NULL, status_id INT NOT NULL, detection_id INT DEFAULT NULL, date_created DATE NOT NULL, date_modified DATE DEFAULT NULL, date_closed DATE DEFAULT NULL, port INT DEFAULT NULL, protocol VARCHAR(10) DEFAULT NULL, INDEX IDX_D7FE2F0472897D8B (vulnerability_id), INDEX IDX_D7FE2F04D8E2CBE7 (remediation_action_id), INDEX IDX_D7FE2F045DA1941 (asset_id), INDEX IDX_D7FE2F046BF700BD (status_id), INDEX IDX_D7FE2F04A8773B17 (detection_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('CREATE TABLE vulndetected_tags (vulnerability_detected_id INT NOT NULL, tag_id INT NOT NULL, INDEX IDX_1BF78AD729518A4D (vulnerability_detected_id), INDEX IDX_1BF78AD7BAD26311 (tag_id), PRIMARY KEY(vulnerability_detected_id, tag_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB');
        $this->addSql('ALTER TABLE action ADD CONSTRAINT FK_47CC8C92D8E2CBE7 FOREIGN KEY (remediation_action_id) REFERENCES remediation_action (id)');
        $this->addSql('ALTER TABLE asset ADD CONSTRAINT FK_2AF5A5CC54C8C93 FOREIGN KEY (type_id) REFERENCES type (id)');
        $this->addSql('ALTER TABLE asset ADD CONSTRAINT FK_2AF5A5C8B4937A1 FOREIGN KEY (vlan_id) REFERENCES vlan (id)');
        $this->addSql('ALTER TABLE asset ADD CONSTRAINT FK_2AF5A5C7E3C61F9 FOREIGN KEY (owner_id) REFERENCES person (id)');
        $this->addSql('ALTER TABLE asset ADD CONSTRAINT FK_2AF5A5C642B8210 FOREIGN KEY (admin_id) REFERENCES person (id)');
        $this->addSql('ALTER TABLE assets_tags ADD CONSTRAINT FK_D7AC0F375DA1941 FOREIGN KEY (asset_id) REFERENCES asset (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE assets_tags ADD CONSTRAINT FK_D7AC0F37BAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE office ADD CONSTRAINT FK_74516B02DCD6CC49 FOREIGN KEY (branch_id) REFERENCES branch (id)');
        $this->addSql('ALTER TABLE person ADD CONSTRAINT FK_34DCD176FFA0C224 FOREIGN KEY (office_id) REFERENCES office (id)');
        $this->addSql('ALTER TABLE product ADD CONSTRAINT FK_D34A04ADF603EE73 FOREIGN KEY (vendor_id) REFERENCES vendor (id)');
        $this->addSql('ALTER TABLE products_tags ADD CONSTRAINT FK_E3AB5A2C4584665A FOREIGN KEY (product_id) REFERENCES product (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE products_tags ADD CONSTRAINT FK_E3AB5A2CBAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE remediation_action ADD CONSTRAINT FK_C49F0909217BBB47 FOREIGN KEY (person_id) REFERENCES person (id)');
        $this->addSql('ALTER TABLE tag_product ADD CONSTRAINT FK_E17B2907BAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE tag_product ADD CONSTRAINT FK_E17B29074584665A FOREIGN KEY (product_id) REFERENCES product (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE tag_asset ADD CONSTRAINT FK_2043435ABAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE tag_asset ADD CONSTRAINT FK_2043435A5DA1941 FOREIGN KEY (asset_id) REFERENCES asset (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE tag_vulnerability_detected ADD CONSTRAINT FK_2ED00885BAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE tag_vulnerability_detected ADD CONSTRAINT FK_2ED0088529518A4D FOREIGN KEY (vulnerability_detected_id) REFERENCES vulnerability_detected (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE type ADD CONSTRAINT FK_8CDE5729C35E566A FOREIGN KEY (family_id) REFERENCES family (id)');
        $this->addSql('ALTER TABLE vulnerability ADD CONSTRAINT FK_6C4E40474584665A FOREIGN KEY (product_id) REFERENCES product (id)');
        $this->addSql('ALTER TABLE vulnerability_detected ADD CONSTRAINT FK_D7FE2F0472897D8B FOREIGN KEY (vulnerability_id) REFERENCES vulnerability (id)');
        $this->addSql('ALTER TABLE vulnerability_detected ADD CONSTRAINT FK_D7FE2F04D8E2CBE7 FOREIGN KEY (remediation_action_id) REFERENCES vulnerability (id)');
        $this->addSql('ALTER TABLE vulnerability_detected ADD CONSTRAINT FK_D7FE2F045DA1941 FOREIGN KEY (asset_id) REFERENCES asset (id)');
        $this->addSql('ALTER TABLE vulnerability_detected ADD CONSTRAINT FK_D7FE2F046BF700BD FOREIGN KEY (status_id) REFERENCES status (id)');
        $this->addSql('ALTER TABLE vulnerability_detected ADD CONSTRAINT FK_D7FE2F04A8773B17 FOREIGN KEY (detection_id) REFERENCES detection (id)');
        $this->addSql('ALTER TABLE vulndetected_tags ADD CONSTRAINT FK_1BF78AD729518A4D FOREIGN KEY (vulnerability_detected_id) REFERENCES vulnerability_detected (id) ON DELETE CASCADE');
        $this->addSql('ALTER TABLE vulndetected_tags ADD CONSTRAINT FK_1BF78AD7BAD26311 FOREIGN KEY (tag_id) REFERENCES tag (id) ON DELETE CASCADE');
    }

    public function down(Schema $schema)
    {
        // this down() migration is auto-generated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() !== 'mysql', 'Migration can only be executed safely on \'mysql\'.');

        $this->addSql('ALTER TABLE assets_tags DROP FOREIGN KEY FK_D7AC0F375DA1941');
        $this->addSql('ALTER TABLE tag_asset DROP FOREIGN KEY FK_2043435A5DA1941');
        $this->addSql('ALTER TABLE vulnerability_detected DROP FOREIGN KEY FK_D7FE2F045DA1941');
        $this->addSql('ALTER TABLE office DROP FOREIGN KEY FK_74516B02DCD6CC49');
        $this->addSql('ALTER TABLE vulnerability_detected DROP FOREIGN KEY FK_D7FE2F04A8773B17');
        $this->addSql('ALTER TABLE type DROP FOREIGN KEY FK_8CDE5729C35E566A');
        $this->addSql('ALTER TABLE person DROP FOREIGN KEY FK_34DCD176FFA0C224');
        $this->addSql('ALTER TABLE asset DROP FOREIGN KEY FK_2AF5A5C7E3C61F9');
        $this->addSql('ALTER TABLE asset DROP FOREIGN KEY FK_2AF5A5C642B8210');
        $this->addSql('ALTER TABLE remediation_action DROP FOREIGN KEY FK_C49F0909217BBB47');
        $this->addSql('ALTER TABLE products_tags DROP FOREIGN KEY FK_E3AB5A2C4584665A');
        $this->addSql('ALTER TABLE tag_product DROP FOREIGN KEY FK_E17B29074584665A');
        $this->addSql('ALTER TABLE vulnerability DROP FOREIGN KEY FK_6C4E40474584665A');
        $this->addSql('ALTER TABLE action DROP FOREIGN KEY FK_47CC8C92D8E2CBE7');
        $this->addSql('ALTER TABLE vulnerability_detected DROP FOREIGN KEY FK_D7FE2F046BF700BD');
        $this->addSql('ALTER TABLE assets_tags DROP FOREIGN KEY FK_D7AC0F37BAD26311');
        $this->addSql('ALTER TABLE products_tags DROP FOREIGN KEY FK_E3AB5A2CBAD26311');
        $this->addSql('ALTER TABLE tag_product DROP FOREIGN KEY FK_E17B2907BAD26311');
        $this->addSql('ALTER TABLE tag_asset DROP FOREIGN KEY FK_2043435ABAD26311');
        $this->addSql('ALTER TABLE tag_vulnerability_detected DROP FOREIGN KEY FK_2ED00885BAD26311');
        $this->addSql('ALTER TABLE vulndetected_tags DROP FOREIGN KEY FK_1BF78AD7BAD26311');
        $this->addSql('ALTER TABLE asset DROP FOREIGN KEY FK_2AF5A5CC54C8C93');
        $this->addSql('ALTER TABLE product DROP FOREIGN KEY FK_D34A04ADF603EE73');
        $this->addSql('ALTER TABLE asset DROP FOREIGN KEY FK_2AF5A5C8B4937A1');
        $this->addSql('ALTER TABLE vulnerability_detected DROP FOREIGN KEY FK_D7FE2F0472897D8B');
        $this->addSql('ALTER TABLE vulnerability_detected DROP FOREIGN KEY FK_D7FE2F04D8E2CBE7');
        $this->addSql('ALTER TABLE tag_vulnerability_detected DROP FOREIGN KEY FK_2ED0088529518A4D');
        $this->addSql('ALTER TABLE vulndetected_tags DROP FOREIGN KEY FK_1BF78AD729518A4D');
        $this->addSql('DROP TABLE action');
        $this->addSql('DROP TABLE asset');
        $this->addSql('DROP TABLE assets_tags');
        $this->addSql('DROP TABLE branch');
        $this->addSql('DROP TABLE detection');
        $this->addSql('DROP TABLE family');
        $this->addSql('DROP TABLE office');
        $this->addSql('DROP TABLE person');
        $this->addSql('DROP TABLE product');
        $this->addSql('DROP TABLE products_tags');
        $this->addSql('DROP TABLE remediation_action');
        $this->addSql('DROP TABLE status');
        $this->addSql('DROP TABLE tag');
        $this->addSql('DROP TABLE tag_product');
        $this->addSql('DROP TABLE tag_asset');
        $this->addSql('DROP TABLE tag_vulnerability_detected');
        $this->addSql('DROP TABLE type');
        $this->addSql('DROP TABLE vendor');
        $this->addSql('DROP TABLE vlan');
        $this->addSql('DROP TABLE vulnerability');
        $this->addSql('DROP TABLE vulnerability_detected');
        $this->addSql('DROP TABLE vulndetected_tags');
    }
}
